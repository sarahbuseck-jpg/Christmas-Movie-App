<%- include('../partials/header', { title: 'Add Actor' }) %>

<div class="container mt-5" style="max-width: 600px;">

    <h2 class="text-center mb-4">Add New Actor</h2>

    <form id="addActorForm">

        <div class="mb-3">
            <label class="form-label fw-bold">First Name</label>
            <input 
                type="text" 
                name="first_name" 
                class="form-control" 
                placeholder="Enter first name" 
                required>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Last Name</label>
            <input 
                type="text" 
                name="last_name" 
                class="form-control" 
                placeholder="Enter last name" 
                required>
        </div>

        <button class="btn btn-primary w-100 fw-bold" type="submit">
            Add Actor
        </button>

    </form>

    <div id="addMessage" class="mt-3"></div>

    <div class="text-center mt-3">
        <a href="/actors" class="btn btn-secondary">Back to Actors</a>
    </div>

</div>

<script>
document.getElementById("addActorForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const form = e.target;
    const formData = new URLSearchParams(new FormData(form));

    const res = await fetch("/api/actors", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: formData
    });

    const data = await res.json();
    const msg = document.getElementById("addMessage");

    // Backend returns:  { message, id, first_name, last_name }
    if (data.id) {
        msg.innerHTML = `<div class="alert alert-success">Actor added!</div>`;
        form.reset();
    } else {
        msg.innerHTML = `<div class="alert alert-danger">Error adding actor.</div>`;
    }
});
</script>

<script>
document.addEventListener("click", async (e) => {
    if (e.target.classList.contains("delete-actor")) {

        const id = e.target.getAttribute("data-id");

        if (!confirm("Delete this actor?")) return;

        const res = await fetch(`/api/actors/${id}`, {
            method: "DELETE"
        });

        const data = await res.json();

        if (data.message === "deleted") {
            // Remove card from page
            document.getElementById(`actor-${id}`).remove();
        } else {
            alert("Error deleting actor.");
        }
    }
});
</script>

<%- include('../partials/footer') %>






